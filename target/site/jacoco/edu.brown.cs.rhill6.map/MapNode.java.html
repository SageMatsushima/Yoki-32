<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MapNode.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">maps</a> &gt; <a href="index.source.html" class="el_package">edu.brown.cs.rhill6.map</a> &gt; <span class="el_source">MapNode.java</span></div><h1>MapNode.java</h1><pre class="source lang-java linenums">package edu.brown.cs.rhill6.map;
import edu.brown.cs.rhill6.stars.KdNode;

import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Objects;

/**
 * Class for a node in the map.
 */
public class MapNode extends KdNode implements Node&lt;MapNode, MapWay&gt; {
  private String id;
  private static final double EARTH_RADIUS = 6371.0;
  /**
   * Constructor for a MapNode.
   * @param id A string id for the node
   * @param latitude A double
   * @param longitude A double
   */
<span class="fc" id="L23">  public MapNode(String id, double latitude, double longitude) {</span>
<span class="fc" id="L24">    this.id = id;</span>
<span class="fc" id="L25">    ArrayList&lt;Double&gt; coords = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L26">    coords.add(latitude);</span>
<span class="fc" id="L27">    coords.add(longitude);</span>
<span class="fc" id="L28">    setCoords(coords);</span>
<span class="fc" id="L29">  }</span>

  /**
   * This method gets outgoing edges from a node as we traverse through dijsktras.
   * @return a list of ways going out from a node
   */
  @Override
  public List&lt;MapWay&gt; getEdges() {
    try {
<span class="fc" id="L38">      PreparedStatement prep = SQLcommands.mapNodeSQL();</span>

<span class="fc" id="L40">      prep.setString(1, id);</span>
<span class="fc" id="L41">      ArrayList&lt;MapWay&gt; edges = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L42">      ResultSet rs = prep.executeQuery();</span>
<span class="fc" id="L43">      HashMap&lt;String, MapNode&gt; nodeIdMap = MapReader.getNodeIdMap();</span>
      //Running through the the result set and getting the node data
<span class="fc bfc" id="L45" title="All 2 branches covered.">      while (rs.next()) {</span>
<span class="fc" id="L46">        String nodeid = rs.getString(&quot;id&quot;);</span>
<span class="fc" id="L47">        String name = rs.getString(&quot;name&quot;);</span>
<span class="fc" id="L48">        String startId = rs.getString(&quot;start&quot;);</span>
<span class="fc" id="L49">        String endId = rs.getString(&quot;end&quot;);</span>

<span class="fc" id="L51">        MapNode start = nodeIdMap.get(startId);</span>
<span class="fc" id="L52">        MapNode end =  nodeIdMap.get(endId);</span>

<span class="fc" id="L54">        MapWay newEdge = new MapWay(nodeid, name, start, end);</span>
<span class="fc" id="L55">        edges.add(newEdge);</span>
<span class="fc" id="L56">      }</span>
<span class="fc" id="L57">      prep.close();</span>
<span class="fc" id="L58">      rs.close();</span>
<span class="fc" id="L59">      return edges;</span>
<span class="nc" id="L60">    } catch (Exception e) {</span>
<span class="nc" id="L61">      System.err.println(&quot;ERROR: Error reading from database&quot;);</span>
<span class="nc" id="L62">      return new ArrayList&lt;&gt;();</span>
    }
  }

  /**
   * Get the id of the star.
   * @return Star id as an integer
   */
  public String getId() {
<span class="fc" id="L71">    return id;</span>
  }

  /**
   * Get the latitude coordinates.
   * @return double
   */
  public double getLatitude() {
<span class="fc" id="L79">    return getCoords().get(0);</span>
  }

  /**
   * Get the longitude coordinate.
   * @return double
   */
  public double getLongitude() {
<span class="fc" id="L87">    return getCoords().get(1);</span>
  }

  /**
   * This method checks if the latitude and longitude of the inputs are the same.
   * @param o object
   * @return
   */
  @Override
  public boolean equals(Object o) {

<span class="fc bfc" id="L98" title="All 2 branches covered.">    if (!(o instanceof MapNode)) {</span>
<span class="fc" id="L99">      return false;</span>
    }

<span class="fc" id="L102">    MapNode s2 = (MapNode) o;</span>
<span class="fc" id="L103">    boolean equal = true;</span>

<span class="pc bpc" id="L105" title="1 of 4 branches missed.">    equal = equal &amp;&amp; (id.equals(s2.getId()));</span>
<span class="pc bpc" id="L106" title="1 of 4 branches missed.">    equal = equal &amp;&amp; (getLatitude() == s2.getLatitude());</span>
<span class="pc bpc" id="L107" title="1 of 4 branches missed.">    equal = equal &amp;&amp; (getLongitude() == s2.getLongitude());</span>

<span class="fc" id="L109">    return equal;</span>
  }

  /**
   * This method hashes the id, latitude and longitude.
   * @return a hash code
   */
  @Override
  public int hashCode() {
<span class="fc" id="L118">    return Objects.hash(id, getLatitude(), getLongitude());</span>
  }


  /**
   * Get the Euclidean distance between the star and the given object.
   * @param o A star or an ArrayList of 3 doubles.
   * @return The distance between the star and the given object
   */
  public double distance(Object o) {
<span class="pc bpc" id="L128" title="1 of 2 branches missed.">    if (o instanceof MapNode) {</span>
<span class="fc" id="L129">      MapNode s2 = (MapNode) o;</span>

<span class="fc" id="L131">      double lat1 = getLatitude();</span>
<span class="fc" id="L132">      double lon1 = getLongitude();</span>
<span class="fc" id="L133">      double lat2 = s2.getLatitude();</span>
<span class="fc" id="L134">      double lon2 = s2.getLongitude();</span>

<span class="fc" id="L136">      return 2 * EARTH_RADIUS * Math.asin(Math.sqrt(</span>
<span class="fc" id="L137">          Math.pow(Math.sin((lat2 - lat1) / 2), 2)</span>
<span class="fc" id="L138">          + Math.cos(lat1) * Math.cos(lat2)</span>
<span class="fc" id="L139">          * Math.pow(Math.sin((lon2 - lon1) / 2), 2)</span>
      ));
    } else {
<span class="nc" id="L142">      System.err.println(</span>
          &quot;ERROR: Node distance must take another MapNode&quot;);
<span class="nc" id="L144">      return -1;</span>
    }
  }

  /**
   * Gets the id of the Node.
   * @return node id
   */
  @Override
  public String toString() {
<span class="fc" id="L154">    return id;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>